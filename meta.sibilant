(namespace http)
(def-curried handle-router-error (res e)

  (.write-head res 500)
  (.end res e.message))

(macro route-handler (...body)
       `(=> ((lit request response route))
            (.catch (.resolve Promise (scoped ...@body))
                    (handle-router-error response))))

(macro with-http-route (args ...body)
       `(.use ...@(content-of args)
              (route-handler ...@body)))
